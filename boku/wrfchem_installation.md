# WRF-Chem Installation

## Environment Setup

Before compiling WRF-Chem, ensure your environment is correctly set up. This typically involves loading the necessary compilers (e.g., `gcc`, `gfortran`), MPI libraries (e.g., OpenMPI, MPICH), and NetCDF/HDF5 libraries. For more details on different compiler setups, see the [WRF-Chem Compiler Setups](./wrfchem_compiler_setup.md) guide.

Example (adjust paths as necessary for your system):

'''bash
# Load necessary modules (if using a module system)
module load intel/2021.2.0
module load openmpi/4.1.1
module load netcdf/4.7.4
module load hdf5/1.12.0

# Set environment variables
export NETCDF=/path/to/netcdf
export HDF5=/path/to/hdf5
export JASPERLIB=/path/to/jasper/lib
export JASPERINC=/path/to/jasper/include
export ZLIB=/path/to/zlib
export PHDF5=/path/to/parallel_hdf5
export PNETCDF=/path/to/parallel_netcdf
'''

## Required Sources

WRF-Chem requires several external libraries and data sources. For a detailed list and links to the official sources, see the [WRF-Chem External Sources](./wrfchem_external_sources.md) guide.

## Compilation

Once the environment is set up and sources are ready, you can proceed with compilation.

1.  **Configure WRF**: Navigate to the WRF source directory and run `./configure`. Select the appropriate option for your compiler and MPI setup (e.g., `dmpar` for distributed memory parallelism).

    '''bash
    ./configure
    '''

2.  **Edit `configure.wrf` (if needed)**: Review the generated `configure.wrf` file. You might need to manually adjust paths or compiler flags, especially for NetCDF, HDF5, and JasPer.

3.  **Compile WRF**: Use the `compile` command. For WRF-Chem, you will typically compile `wrf.exe`, `real.exe`, and `ndown.exe` (if using nested domains).

    '''bash
    ./compile em_real >& compile.log
    '''

    Check the `compile.log` for any errors. Successful compilation will result in executables like `wrf.exe`, `real.exe`, `ndown.exe` in the `main/` directory.

4.  **Compile WRF-Chem Specific Programs**: Depending on your chemical mechanism, you may need to compile additional programs (e.g., `mozbc`, `prep_chem_sources`). Refer to the WRF-Chem user guide for details.

## Verifying the Installation

After a successful compilation, you should see the following executables in the `main/` directory:

-   `wrf.exe`: The main model executable.
-   `real.exe`: The real data initialization program.
-   `ndown.exe`: For one-way nesting.
-   `tc.exe`: For tropical cyclone bogus scheme.

The best way to verify the installation is to run one of the idealized test cases that come with the WRF-Chem source code.

## Common Compilation Errors

Compiling WRF-Chem can be challenging. Here are some common errors and their solutions:

-   **`undefined reference to` errors**: This usually means the compiler cannot find a required library (e.g., NetCDF, HDF5). Double-check your `NETCDF` and `HDF5` environment variables and your `LD_LIBRARY_PATH`.
-   **KPP errors**: If you are using a KPP-based mechanism, errors can arise from the KPP build process itself. Ensure you have `flex` and `bison` installed and that the `YACC` and `FLEX_LIB_DIR` environment variables are set correctly.
-   **`No rule to make target` errors**: This can happen for some utilities like `convert_emiss`. A common workaround is to use an older version of WRF-Chem to compile the utility.
-   **Compiler mismatch errors**: If you see an error like "This module file was not generated by any release of this compiler," it means you have old files from a previous compilation. Run `./clean -a` and recompile.

For more detailed troubleshooting, always examine the `compile.log` file and consult the official WRF-Chem User's Guide and support forum.
