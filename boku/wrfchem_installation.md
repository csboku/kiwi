# WRF-Chem Installation: A Quick Start Guide

This guide provides a streamlined overview of the WRF-Chem installation process. For a highly detailed, step-by-step guide that covers compiling all dependencies from source, please see the [Comprehensive Compilation Guide](./wrfchem_compilation_guide.md).

## 1. Environment Setup: The Foundation

A successful WRF-Chem build starts with a properly configured environment.

### Compiler Choice

You must use the same compiler suite (Fortran, C, C++) for all components. The two most common choices are:

-   **Intel (Recommended for Performance)**:
    -   **oneAPI (Modern)**: `ifx` (Fortran), `icx` (C), `icpx` (C++).
    -   **Classic**: `ifort` (Fortran), `icc` (C), `icpc` (C++).
-   **GNU (Free and Open-Source)**: `gfortran`, `gcc`, `g++`.

### Environment Variables

Before you begin, set the following environment variables. This is a critical step.

```bash
# Set this to a directory where you will build your libraries
export DIR_LIBRARIES=~/wrf-chem-build/libs

# Set this to your chosen compilers (choose one block)

# --- Intel oneAPI ---
export CC=icx
export CXX=icpx
export FC=ifx

# --- GNU ---
# export CC=gcc
# export CXX=g++
# export FC=gfortran

# Set paths for dependencies
export NETCDF=$DIR_LIBRARIES/netcdf
export HDF5=$DIR_LIBRARIES/hdf5
export PNETCDF=$DIR_LIBRARIES/pnetcdf

# Update library path
export LD_LIBRARY_PATH=$NETCDF/lib:$HDF5/lib:$PNETCDF/lib:$LD_LIBRARY_PATH
```

## 2. Acquiring the Source Code

You will need the source code for WRF-Chem and its dependencies.

-   **WRF-Chem**: The source code is available from the [WRF-Model GitHub Repository](https://github.com/wrf-model/WRF). You must register on the WRF website to gain access.
-   **Dependencies**: For specific, tested versions of NetCDF, HDF5, and pnetcdf, refer to the [Comprehensive Compilation Guide](./wrfchem_compilation_guide.md).

## 3. The Compilation Process

The general workflow is to compile the dependencies first, then WRF-Chem itself.

1.  **Compile Dependencies**: Compile HDF5, pnetcdf, NetCDF-C, and NetCDF-Fortran in that order. Detailed instructions are in the [Comprehensive Compilation Guide](./wrfchem_compilation_guide.md).
2.  **Set WRF-Chem Environment**: Before compiling WRF, you must set:
    ```bash
    export WRF_CHEM=1
    export WRF_KPP=1
    ```
3.  **Configure WRF-Chem**: Navigate to the WRF source directory and run:
    ```bash
    ./configure
    ```
    Choose the option that matches your compiler and desired level of parallelism (e.g., `dmpar` for distributed memory).
4.  **Compile WRF-Chem**:
    ```bash
    ./compile em_real >& compile.log
    ```
    The `>&` redirects both standard output and standard error to the `compile.log` file.

## 4. Verifying the Installation

A successful compilation will place several executables in the `WRF/main/` directory, including:

-   `wrf.exe`
-   `real.exe`
-   `ndown.exe`
-   `tc.exe`

The most reliable way to verify your build is to run an idealized test case, such as `em_real`.

## 5. Common Compilation Errors

-   **`undefined reference to`**: Almost always a library linking issue. Double-check your `LD_LIBRARY_PATH` and ensure all libraries were built with the same compiler.
-   **KPP Errors**: Often caused by missing `flex` or `bison`. Ensure they are installed and that the `YACC` environment variable is set.
-   **Compiler Mismatches**: If you see errors about module files not being generated by the compiler, it means you have leftover files from a previous build. **Always run `./clean -a` before re-configuring and re-compiling.**

For a deep dive into troubleshooting, refer to the `compile.log` file and the [Comprehensive Compilation Guide](./wrfchem_compilation_guide.md).