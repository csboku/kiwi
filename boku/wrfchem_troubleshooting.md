# WRF-Chem Troubleshooting Guide

This guide provides a comprehensive overview of common errors encountered during the compilation and execution of WRF-Chem, along with their solutions.

## 1. Compilation Errors

### `undefined reference to`

-   **Symptom**: The compilation fails with messages like `undefined reference to 'nf_open_'` or `undefined reference to 'H5Fopen'`.
-   **Cause**: This is a library linking error. The compiler cannot find the required NetCDF, HDF5, or other library.
-   **Solution**:
    1.  **Check `LD_LIBRARY_PATH`**: Ensure that the `lib` directories of all required libraries are in your `LD_LIBRARY_PATH`.
    2.  **Check `configure.wrf`**: After running `./configure`, inspect the `configure.wrf` file to ensure the paths to your libraries are correct.
    3.  **Compiler Consistency**: You **must** use the same compiler suite for all libraries and for WRF-Chem itself.

### KPP Errors

-   **Symptom**: The compilation fails with errors related to `kpp`, `flex`, or `yacc`.
-   **Cause**: The Kinetic Pre-Processor (KPP) failed to build.
-   **Solution**:
    1.  **Install `flex` and `bison`**: Ensure that `flex` and `bison` (a `yacc` replacement) are installed on your system.
    2.  **Set `YACC`**: Set the `YACC` environment variable: `export YACC='/usr/bin/yacc -d'`.

### Compiler Mismatch Errors

-   **Symptom**: The compilation fails with an error like "This module file was not generated by any release of this compiler."
-   **Cause**: You have leftover files from a previous compilation with a different compiler.
-   **Solution**: **Always run `./clean -a`** before re-configuring and re-compiling.

## 2. Runtime Errors

### `cfl` Errors

-   **Symptom**: The model crashes with an error message containing "cfl".
-   **Cause**: The Courant-Friedrichs-Lewy (CFL) condition has been violated, indicating model instability. This is almost always caused by a time step that is too long.
-   **Solution**: Reduce the `time_step` in your `namelist.input` file.

### Segmentation Faults

-   **Symptom**: The model crashes with a "Segmentation Fault" error.
-   **Cause**: This is a generic error that can be caused by many issues.
-   **Solution**:
    1.  **Check Input Data**: Carefully check your `wrfinput`, `wrfbdy`, and `wrfchemi` files for corrupted or unreasonable values.
    2.  **Simplify Your Configuration**: Try running with a simpler configuration (e.g., no chemistry) to isolate the problem.
    3.  **Consult the WRF Forum**: The WRF & MPAS-A Support Forum is the best resource for debugging segmentation faults.

### Input Data Errors

-   **Symptom**: The model crashes with an error message related to missing or incorrect input data.
-   **Cause**: There is a mismatch between your `namelist.input` and your input files.
-   **Solution**:
    -   **`ERROR: Could not find ...`**: A required variable is missing from your `met_em*` files. Check your WPS configuration.
    -   **`ERROR: Chemistry routines require ...`**: Your input data (e.g., land use) is not compatible with your chosen chemistry options.

By systematically working through these common errors, you can resolve most issues encountered when working with WRF-Chem.
